<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: sans-serif;
        padding: 2em;
      }
    </style>
  </head>
  <body>
    <div id="projects">
      <h3
        id="project-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >ğŸ“</span
        ><span>Project List</span>
      </h3>
      <ul id="project-list">
        <li>Loading...</li>
      </ul>
    </div>
    <div id="recent">
      <h3
        id="recent-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >ğŸ•’</span
        ><span>Recently Opened</span>
      </h3>
      <ul id="recent-list">
        <li>Loading...</li>
      </ul>
    </div>
    <script>
      const vscode = acquireVsCodeApi();
      function requestData() {
        vscode.postMessage({ type: "getData" });
      }
      requestData();
      setInterval(requestData, 1000);
      // h2ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨vscodeå‘½ä»¤ï¼Œåªç»‘å®šä¸€æ¬¡
      document
        .getElementById("project-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenProject",
          });
        });
      document
        .getElementById("recent-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenRecent",
          });
        });

      window.addEventListener("message", (event) => {
        const msg = event.data;
        if (msg.type === "data") {
          const { recent, project, currentDir } = msg.data;
          // å…¼å®¹è€æ‰©å±•ç«¯ï¼šå¦‚æœæ²¡æœ‰ currentDirï¼Œåˆ™ä¸é«˜äº®
          let curDir = currentDir;
          if (!curDir && window.vscodeCurrentDir)
            curDir = window.vscodeCurrentDir;

          const recentList = document.getElementById("recent-list");
          recentList.innerHTML = recent.length
            ? recent
                .map((d) => {
                  const isCurrent = curDir && d.dir === curDir;
                  return `<li data-dir="${d.dir}" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "â¡ï¸ " : ""}${
                    d.label
                  } <span style="color:#888">${d.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";
          const projectList = document.getElementById("project-list");
          projectList.innerHTML = project.length
            ? project
                .map((p) => {
                  const isCurrent = curDir && p.dir === curDir;
                  return `<li data-dir="${p.dir}" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "â¡ï¸ " : ""}${
                    p.label
                  } <span style="color:#888">${p.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";

          // ç»‘å®šç‚¹å‡»äº‹ä»¶
          document
            .querySelectorAll(
              "#recent-list li[data-dir], #project-list li[data-dir]"
            )
            .forEach((li) => {
              li.addEventListener("click", () => {
                const dir = li.getAttribute("data-dir");
                if (dir) {
                  vscode.postMessage({ type: "openProject", dir });
                }
              });
            });
        }
      });
    </script>
  </body>
</html>
