<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: sans-serif;
        padding: 1em 1em 1em 1em;
      }
      .scroll-list {
        max-height: 20em;
        overflow-y: auto;
        padding-right: 0.5em;
        position: relative;
      }
      .scroll-tip {
        text-align: center;
        color: #888;
        font-size: 0.95em;
        background: linear-gradient(to bottom, transparent, #fff 80%);
        position: absolute;
        left: 0;
        right: 0;
        z-index: 2;
        pointer-events: none;
        padding-bottom: 0.2em;
        padding-top: 0.2em;
      }
      #project-scroll-tip,
      #recent-scroll-tip {
        bottom: 0.2em;
        top: auto;
      }
      #project-scroll-tip-up,
      #recent-scroll-tip-up {
        top: 2.5em;
        bottom: auto;
        margin-top: 0.7em;
        background: linear-gradient(to bottom, transparent, #fff 80%);
        box-shadow: none;
        border-radius: 0;
        pointer-events: none;
        cursor: default;
        width: auto;
        left: 0;
        transform: none;
        padding: 0.2em 0;
      }
      .list-container {
        position: relative;
      }
      .scroll-list li {
        line-height: 2em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .list-container {
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 8px 0 #0001;
        padding: 1em;
        margin-bottom: 2em;
        background: #fff;
      }
    </style>
  </head>
  <body>
    <div id="projects" class="list-container">
      <h3
        id="project-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >üìÅ</span
        ><span>Project List</span>
      </h3>
      <div
        class="scroll-tip"
        id="project-scroll-tip-up"
        style="display: none; top: 2.5em; bottom: auto"
      >
        ‚Üë Back to Top
      </div>
      <ul id="project-list" class="scroll-list">
        <li>Loading...</li>
      </ul>
      <div class="scroll-tip" id="project-scroll-tip" style="display: none">
        ‚Üì Scroll for more
      </div>
    </div>
    <div id="recent" class="list-container">
      <h3
        id="recent-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >üïí</span
        ><span>Recently Opened</span>
      </h3>
      <div
        class="scroll-tip"
        id="recent-scroll-tip-up"
        style="display: none; top: 2.5em; bottom: auto"
      >
        ‚Üë Back to Top
      </div>
      <ul id="recent-list" class="scroll-list">
        <li>Loading...</li>
      </ul>
      <div class="scroll-tip" id="recent-scroll-tip" style="display: none">
        ‚Üì Scroll for more
      </div>
    </div>
    <script>
      const vscode = acquireVsCodeApi();
      function requestData() {
        vscode.postMessage({ type: "getData" });
      }
      requestData();
      setInterval(requestData, 1000);
      // h2ÁÇπÂáª‰∫ã‰ª∂ÔºåË∞ÉÁî®vscodeÂëΩ‰ª§ÔºåÂè™ÁªëÂÆö‰∏ÄÊ¨°
      document
        .getElementById("project-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenProject",
          });
        });
      document
        .getElementById("recent-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenRecent",
          });
        });

      window.addEventListener("message", (event) => {
        const msg = event.data;
        if (msg.type === "data") {
          const { recent, project, currentDir } = msg.data;
          // ÂÖºÂÆπËÄÅÊâ©Â±ïÁ´ØÔºöÂ¶ÇÊûúÊ≤°Êúâ currentDirÔºåÂàô‰∏çÈ´ò‰∫Æ
          let curDir = currentDir;
          if (!curDir && window.vscodeCurrentDir)
            curDir = window.vscodeCurrentDir;

          const recentList = document.getElementById("recent-list");
          recentList.innerHTML = recent.length
            ? recent
                .map((d) => {
                  const isCurrent = curDir && d.dir === curDir;
                  return `<li data-dir="${d.dir}" title="${d.label}\n${
                    d.dir
                  }" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "‚û°Ô∏è " : ""}${
                    d.label
                  } <span style="color:#888">${d.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";
          const projectList = document.getElementById("project-list");
          projectList.innerHTML = project.length
            ? project
                .map((p) => {
                  const isCurrent = curDir && p.dir === curDir;
                  return `<li data-dir="${p.dir}" title="${p.label}\n${
                    p.dir
                  }" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "‚û°Ô∏è " : ""}${
                    p.label
                  } <span style="color:#888">${p.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";

          // Â§ÑÁêÜÊªöÂä®ÊèêÁ§∫ÁöÑÊòæÁ§∫‰∏éÈöêËóèÔºàÁßªÂà∞ulÂ§ñÈÉ®Ôºâ
          function handleScrollTip(listId, tipDownId, tipUpId, show) {
            const list = document.getElementById(listId);
            const tipDown = document.getElementById(tipDownId);
            const tipUp = document.getElementById(tipUpId);
            if (tipDown) tipDown.style.display = "none";
            if (tipUp) tipUp.style.display = "none";
            if (!show) return;
            function updateTip() {
              // Âêë‰∏ãÊèêÁ§∫ÔºöÂÆπÂô®ÂèØÊªöÂä®‰∏îÊú™Âà∞Â∫ïÈÉ®Êó∂ÊòæÁ§∫
              if (tipDown) {
                if (
                  list.scrollHeight - list.scrollTop >
                  list.clientHeight + 2
                ) {
                  tipDown.style.display = "";
                } else {
                  tipDown.style.display = "none";
                }
              }
              // Âêë‰∏äÊèêÁ§∫ÔºöÊú™Âà∞È°∂ÈÉ®Êó∂ÊòæÁ§∫
              if (tipUp) {
                if (list.scrollTop > 2) {
                  tipUp.style.display = "";
                } else {
                  tipUp.style.display = "none";
                }
              }
            }
            updateTip();
            list.removeEventListener(
              "scroll",
              list._scrollTipHandler || (() => {})
            );
            list._scrollTipHandler = updateTip;
            list.addEventListener("scroll", updateTip);
          }
          handleScrollTip(
            "recent-list",
            "recent-scroll-tip",
            "recent-scroll-tip-up",
            recent.length > 10
          );
          handleScrollTip(
            "project-list",
            "project-scroll-tip",
            "project-scroll-tip-up",
            project.length > 10
          );

          // ÁªëÂÆöÁÇπÂáª‰∫ã‰ª∂
          document
            .querySelectorAll(
              "#recent-list li[data-dir], #project-list li[data-dir]"
            )
            .forEach((li) => {
              li.addEventListener("click", () => {
                const dir = li.getAttribute("data-dir");
                if (dir) {
                  vscode.postMessage({ type: "openProject", dir });
                }
              });
            });
        }
      });
    </script>
  </body>
</html>
