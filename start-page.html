<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <style>
      body {
        font-family: sans-serif;
        padding: 1em 1em 1em 1em;
      }
      .scroll-list {
        max-height: 20em;
        overflow-y: auto;
        padding-right: 0.5em;
        position: relative;
        transition: box-shadow 0.2s, background 0.2s;
      }
      .scroll-list li {
        margin: 0.3em 0;
        border-radius: 6px;
        padding: 0 0.8em;
        /* å»é™¤æ‰€æœ‰æµ®åŠ¨ç›¸å…³å±æ€§ */
        transition: background 0.18s, color 0.18s;
        /* ä¸è®¾ç½® borderã€box-shadowã€transform ç­‰ */
      }
      .scroll-list li:hover {
        background: var(--vscode-list-hoverBackground, #e6fbe9);
        color: var(--vscode-list-activeSelectionForeground, #219150);
        /* å»é™¤ borderï¼Œé¿å…å›  border å˜åŒ–å¯¼è‡´çš„æŠ–åŠ¨æˆ–æµ®åŠ¨æ„Ÿ */
        cursor: pointer;
      }
      .scroll-tip {
        text-align: center;
        color: #888;
        font-size: 0.95em;
        background: linear-gradient(to bottom, transparent, #fff 80%);
        position: absolute;
        left: 0;
        right: 0;
        z-index: 2;
        pointer-events: none;
        padding-bottom: 0.2em;
        padding-top: 0.2em;
      }
      #project-scroll-tip,
      #recent-scroll-tip {
        bottom: 0.2em;
        top: auto;
      }
      #project-scroll-tip-up,
      #recent-scroll-tip-up {
        top: 2.5em;
        bottom: auto;
        margin-top: 0.7em;
        background: linear-gradient(to bottom, transparent, #fff 80%);
        box-shadow: none;
        border-radius: 0;
        pointer-events: none;
        cursor: default;
        width: auto;
        left: 0;
        transform: none;
        padding: 0.2em 0;
      }
      .list-container {
        position: relative;
      }
      .scroll-list li {
        line-height: 2em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .list-container {
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 8px 0 #0001;
        padding: 1em;
        margin-bottom: 2em;
        background: #fff;
      }
      .tip-box {
        background: #f3f7fa;
        border-left: 4px solid #007acc;
        color: #333;
        padding: 1em 1.5em;
        margin-bottom: 1.5em;
        border-radius: 4px;
        font-size: 1em;
      }
    </style>
  </head>
  <body>
    <!-- <div class="tip-box">
      âš¡ æç¤ºï¼šé¡¹ç›®å’Œæœ€è¿‘åˆ—è¡¨å¦‚å†…å®¹è¿‡å¤šå¯æ»šåŠ¨æŸ¥çœ‹ï¼Œä»…æ˜¾ç¤ºéƒ¨åˆ†å†…å®¹ã€‚
    </div> -->
    <div id="projects" class="list-container">
      <h3
        id="project-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >ğŸ“</span
        ><span>Project List</span>
      </h3>
      <div
        class="scroll-tip"
        id="project-scroll-tip-up"
        style="display: none; top: 2.5em; bottom: auto"
      >
        â†‘ Back to Top
      </div>
      <ul id="project-list" class="scroll-list">
        <li>Loading...</li>
      </ul>
      <div class="scroll-tip" id="project-scroll-tip" style="display: none">
        â†“ Scroll for more
      </div>
    </div>
    <div id="recent" class="list-container">
      <h3
        id="recent-header"
        style="cursor: pointer; display: flex; align-items: center; gap: 0.5em"
      >
        <span style="font-size: 1em; line-height: 1; vertical-align: middle"
          >ğŸ•’</span
        ><span>Recently Opened</span>
      </h3>
      <div
        class="scroll-tip"
        id="recent-scroll-tip-up"
        style="display: none; top: 2.5em; bottom: auto"
      >
        â†‘ Back to Top
      </div>
      <ul id="recent-list" class="scroll-list">
        <li>Loading...</li>
      </ul>
      <div class="scroll-tip" id="recent-scroll-tip" style="display: none">
        â†“ Scroll for more
      </div>
    </div>
    <script>
      const vscode = acquireVsCodeApi();
      function requestData() {
        vscode.postMessage({ type: "getData" });
      }
      requestData();
      // setInterval(requestData, 1000); // ç§»é™¤è‡ªåŠ¨åˆ·æ–°
      // ç›‘å¬æ¥è‡ª extension çš„åˆ·æ–°æ¶ˆæ¯ï¼Œæ”¶åˆ°åä¸»åŠ¨è¯·æ±‚æ•°æ®
      window.addEventListener("message", (event) => {
        const msg = event.data;
        if (msg.type === "refresh") {
          requestData();
        }
      });
      // h2ç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨vscodeå‘½ä»¤ï¼Œåªç»‘å®šä¸€æ¬¡
      document
        .getElementById("project-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenProject",
          });
        });
      document
        .getElementById("recent-header")
        ?.addEventListener("click", () => {
          vscode.postMessage({
            type: "vscode-command",
            command: "easy-project-manager.quickOpenRecent",
          });
        });

      window.addEventListener("message", (event) => {
        const msg = event.data;
        if (msg.type === "data") {
          const { recent, project, currentDir } = msg.data;
          // å…¼å®¹è€æ‰©å±•ç«¯ï¼šå¦‚æœæ²¡æœ‰ currentDirï¼Œåˆ™ä¸é«˜äº®
          let curDir = currentDir;
          if (!curDir && window.vscodeCurrentDir)
            curDir = window.vscodeCurrentDir;

          const recentList = document.getElementById("recent-list");
          recentList.innerHTML = recent.length
            ? recent
                .map((d) => {
                  const isCurrent = curDir && dirEquals(d.dir, curDir);
                  return `<li data-dir="${d.dir}" title="${d.label}\n${
                    d.dir
                  }" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "â¡ï¸ " : ""}${
                    d.label
                  } <span style="color:#888">${d.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";
          const projectList = document.getElementById("project-list");
          projectList.innerHTML = project.length
            ? project
                .map((p) => {
                  const isCurrent = curDir && dirEquals(p.dir, curDir);
                  return `<li data-dir="${p.dir}" title="${p.label}\n${
                    p.dir
                  }" style="cursor:pointer;${
                    isCurrent ? "font-weight:bold;color:#007acc;" : ""
                  }">${isCurrent ? "â¡ï¸ " : ""}${
                    p.label
                  } <span style="color:#888">${p.dir}</span></li>`;
                })
                .join("")
            : "<li>None</li>";

          // å¤„ç†æ»šåŠ¨æç¤ºçš„æ˜¾ç¤ºä¸éšè—ï¼ˆç§»åˆ°ulå¤–éƒ¨ï¼‰
          function handleScrollTip(listId, tipDownId, tipUpId, show) {
            const list = document.getElementById(listId);
            const tipDown = document.getElementById(tipDownId);
            const tipUp = document.getElementById(tipUpId);
            if (tipDown) tipDown.style.display = "none";
            if (tipUp) tipUp.style.display = "none";
            if (!show) return;
            function updateTip() {
              // å‘ä¸‹æç¤ºï¼šå®¹å™¨å¯æ»šåŠ¨ä¸”æœªåˆ°åº•éƒ¨æ—¶æ˜¾ç¤º
              if (tipDown) {
                if (
                  list.scrollHeight - list.scrollTop >
                  list.clientHeight + 2
                ) {
                  tipDown.style.display = "";
                } else {
                  tipDown.style.display = "none";
                }
              }
              // å‘ä¸Šæç¤ºï¼šæœªåˆ°é¡¶éƒ¨æ—¶æ˜¾ç¤º
              if (tipUp) {
                if (list.scrollTop > 2) {
                  tipUp.style.display = "";
                } else {
                  tipUp.style.display = "none";
                }
              }
            }
            updateTip();
            list.removeEventListener(
              "scroll",
              list._scrollTipHandler || (() => {})
            );
            list._scrollTipHandler = updateTip;
            list.addEventListener("scroll", updateTip);
          }
          function dirEquals(a, b) {
            if (!a || !b) return false;
            return a.toLowerCase() === b.toLowerCase();
          }
          handleScrollTip(
            "recent-list",
            "recent-scroll-tip",
            "recent-scroll-tip-up",
            recent.length > 10
          );
          handleScrollTip(
            "project-list",
            "project-scroll-tip",
            "project-scroll-tip-up",
            project.length > 10
          );

          // ç»‘å®šç‚¹å‡»äº‹ä»¶
          document
            .querySelectorAll(
              "#recent-list li[data-dir], #project-list li[data-dir]"
            )
            .forEach((li) => {
              li.addEventListener("click", () => {
                const dir = li.getAttribute("data-dir");
                if (dir) {
                  vscode.postMessage({ type: "openProject", dir });
                }
              });
            });
        }
      });
    </script>
  </body>
</html>
